<!doctype html>
<html>
    <title>Vcare Asia</title>
    <head>
        {% block stylesheets %}
            <link rel="stylesheet" href="{{ asset('assets/web/css/style.css') }}" type="text/css"/>
        {% endblock %}
    </head>

    <body>
    {% if 'fulfilled' == order.state %}
        <div class="invoice-box">
            {% if app.request.get('printout') %}
                <script>window.print();</script>
            {% else %}
                <div class="text-xs-right" style="margin-bottom: 1rem">
                    <a class="btn btn-lg btn-secondary" target="printout" href="{{ path('sylius_shop_account_order_incoice', {number: order.number, printout: 1}) }}">
                        <i class="fa fa-print"></i> {{ "Print" }}
                    </a>
                    <iframe name="printout" style="visibility: hidden;width: 0; height: 0; position: absolute;"></iframe>
                </div>
            {% endif %}

            <table cellpadding="0" cellspacing="0">
                <tr class="top">
                    <td colspan="4">
                        <table>
                            <tr>
                                <td class="title">
                                    <img src="{{ asset('favicon.png') }}">
                                </td>
                                <td>
                                    {{ 'sylius.ui.invoice'|trans }} #{{ order.number }}<br>
                                    {{ 'sylius.ui.placed_at'|trans }}: {{ order.createdAt|localizeddate }}<br>
                                    {{ ('sylius.ui.' ~ order.shippingState)|trans }}
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>

                <tr class="information">
                    {% set address = order.shippingAddress %}
                    <td colspan="4">
                        <table>
                            <tr>
                                <td>
                                    {% if address.company %}
                                        <div class="account-menu__content--address-header">
                                            {{ address.company }}
                                        </div>
                                    {% endif %}

                                    <div class="account-menu__content--address-detail">
                                        <p>{{ address.street }}</p>
                                        <p>{{ address.city }}</p>

                                        {% if address|sylius_province_name is not empty %}
                                            {{ address|sylius_province_name }}<br/>
                                        {% endif %}

                                        <p>{{ address.countryCode|sylius_country_name|upper }} {{ address.postcode }}</p>
                                    </div>
                                </td>

                                <td>
                                    <div class="account-menu__content--address-header">
                                        {{ address.firstName }} {{ address.lastName }}
                                    </div>

                                    <div class="account-menu__content--address-detail">
                                        {{ address.phoneNumber }}
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>

                {# payment method #}
                {% if order.payments|length %}
                    <tr class="heading">
                        <td colspan="3">
                            {{ 'sylius.ui.payment_method'|trans }}
                        </td>
                        <td>
                            {{ 'sylius.ui.amount'|trans }}
                        </td>
                    </tr>
                    {% for payment in order.payments %}
                        <tr class="item">
                            <td colspan="3">
                                {{ payment.method.code ~ ': ' ~ payment.method.gateway }}
                            </td>
                            <td>
                                {{ payment.amount|sylius_price(payment.currencyCode, payment.order.exchangeRate) }}
                            </td>
                        </tr>
                    {% endfor %}
                {% endif %}

                {# product items #}
                <tr class="heading">
                    <td>
                        {{ 'sylius.ui.product'|trans }}
                    </td>
                    <td class="account-menu__product-table--qty">
                        {{ 'sylius.ui.qty'|trans }}
                    </td>
                    <td class="account-menu__product-table--price">
                        {{ 'sylius.ui.price'|trans }}
                    </td>
                    <td class="account-menu__product-table--total">
                        {{ 'sylius.ui.total'|trans }}
                    </td>
                </tr>

                {% for item in order.items %}
                    <tr class="item{% if loop.index == order.items|length %} last{% endif %}">
                        <td>
                            {{ item.product.name }}
                        </td>
                        <td class="account-menu__product-table--qty">
                            {{ item.quantity }}
                        </td>
                        <td class="account-menu__product-table--price">
                            {{ item.unitPrice|sylius_price(order.currencyCode, order.exchangeRate) }}
                        </td>
                        <td class="account-menu__product-table--total">
                            {{ item.subtotal|sylius_price(order.currencyCode, order.exchangeRate) }}
                        </td>
                    </tr>
                {% endfor %}

                {# items total #}
                <tr class="total">
                    <td colspan="3">
                        <span class="pull-right">{{ 'sylius.ui.subtotal'|trans }}:</span>
                    </td>
                    <td>{{ order.itemsTotal|sylius_price(order.currencyCode, order.exchangeRate) }}</td>
                </tr>

                {# tax total #}
                <tr>
                    <td colspan="3">
                        <span class="pull-right">{{ 'sylius.ui.tax_total'|trans }}:</span>
                    </td>
                    <td>
                        {{ order.taxTotal|sylius_price(order.currencyCode, order.exchangeRate) }}
                    </td>
                </tr>

                {# shipping total #}
                <tr>
                    <td colspan="3">
                        <span class="pull-right">{{ 'sylius.ui.shipping_total'|trans }}:</span>
                    </td>
                    <td>
                        {{ order.shippingTotal|sylius_price(order.currencyCode, order.exchangeRate) }}
                    </td>
                </tr>

                {% set orderPromotionAdjustment = constant('Sylius\\Component\\Core\\Model\\AdjustmentInterface::ORDER_PROMOTION_ADJUSTMENT') %}
                {% set orderPromotions = sylius_aggregate_adjustments(order.getAdjustmentsRecursively(orderPromotionAdjustment)) %}

                {% if not orderPromotions is empty %}
                    <tr>
                        <td class="text-align-right" colspan="3">
                            <strong>{{ 'sylius.ui.promotion_total'|trans }}</strong><br>
                            <ul>
                                {% for label, amount in orderPromotions %}
                                    <li class="item">
                                        {{ label }} {% if not amount == 0 %}-{% endif %}{{ (-1 * amount)|sylius_price(order.currencyCode, order.exchangeRate) }}
                                    </li>
                                {% endfor %}
                            </ul>
                        </td>

                        {% set orderDiscount = order.adjustmentsTotalRecursively(orderPromotionAdjustment) %}

                        <td>
                            {% if not orderDiscount == 0 %}-{% endif %}{{ (-1 * orderDiscount)|sylius_price(order.currencyCode, order.exchangeRate) }}
                        </td>
                    </tr>
                {% endif %}

                {# all total total #}
                <tr class="total">
                    <td colspan="3">
                        <span class="pull-right">{{ 'sylius.ui.total'|trans }}:</span>
                    </td>
                    <td>{{ order.total|sylius_price(order.currencyCode, order.exchangeRate) }}</td>
                </tr>
            </table>
        </div>
    {% else %}

    {% endif %}
    </body>
</html>
